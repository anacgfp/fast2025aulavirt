Vagrant.configure("2") do |config|
  config.vm.box = "ubuntu/focal64"
  config.vm.hostname = "fast-lab-vm"
  bridge_iface = "Realtek PCIe GbE Family Controller"

  config.vm.synced_folder "../docker/app", "/home/vagrant/app",
    owner: "vagrant", group: "vagrant"

  config.vm.provider "virtualbox" do |vb|
    vb.name = "lab-vm"
    vb.memory = 2048
    vb.cpus = 2
  end

  # Provision script para instalar o Docker
config.vm.provision "shell", privileged: true, inline: <<-SHELL
    apt-get update
    apt-get install -y ca-certificates curl gnupg

    install -m 0755 -d /etc/apt/keyrings
    curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
    chmod a+r /etc/apt/keyrings/docker.asc

    echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] \
    https://download.docker.com/linux/ubuntu $(. /etc/os-release && echo ${UBUNTU_CODENAME:-$VERSION_CODENAME}) stable" \
    > /etc/apt/sources.list.d/docker.list

    apt-get update
    apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

    # garantir grupo e adicionar o usu√°rio correto
    groupadd -f docker
    usermod -aG docker vagrant

    systemctl enable --now docker
  SHELL
end
